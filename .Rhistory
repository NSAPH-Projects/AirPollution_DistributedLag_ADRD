cum_high = exp(fit_cum + se_cum),
df = df,
exp = exp)
# plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
#                               est = exp(res[[df]]$cp$matfit[q3,] -
#                                           res[[df]]$cp$matfit[q1,]),
#                               low = exp(log(res[[df]]$cp$matRRlow[q3,]) -
#                                           log(res[[df]]$cp$matRRlow[q1,])),
#                               high = exp(log(res[[df]]$cp$matRRhigh[q3,]) -
#                                            log(res[[df]]$cp$matRRhigh[q1,])),
#                               df = df,
#                               exp = exp)
}
plot_dat <- rbindlist(plot_dat)
#### ggplot: df = 3 ####
plot_dat$exp <- factor(plot_dat$exp, levels = c("pm25", "no2", "ozone"),
labels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
plot_dat <- list()
for (exp in c("pm25")) {
load(paste0(dir_data, "analysis/gamns3log_dlm_comprisk_contUS_", AD_ADRD, "_",
code_type, "_", exp, ".rda"))
df <- 3
exp_iqr <- 10
fit <- res[[df]]$cp$matfit[2,] * exp_iqr
se <- res[[df]]$cp$matse[2,] * 1.96 * exp_iqr
fit_cum <- res[[df]]$cp$allfit[2] * exp_iqr
se_cum <- res[[df]]$cp$allse[2] * exp_iqr * 1.96
plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
est = exp(fit),
low = exp(fit - se),
high = exp(fit + se),
cum = exp(fit_cum),
cum_low = exp(fit_cum - se_cum ),
cum_high = exp(fit_cum + se_cum),
df = df,
exp = exp)
# plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
#                               est = exp(res[[df]]$cp$matfit[q3,] -
#                                           res[[df]]$cp$matfit[q1,]),
#                               low = exp(log(res[[df]]$cp$matRRlow[q3,]) -
#                                           log(res[[df]]$cp$matRRlow[q1,])),
#                               high = exp(log(res[[df]]$cp$matRRhigh[q3,]) -
#                                            log(res[[df]]$cp$matRRhigh[q1,])),
#                               df = df,
#                               exp = exp)
}
plot_dat <- rbindlist(plot_dat)
#### ggplot: df = 3 ####
plot_dat$exp <- factor(plot_dat$exp, levels = c("pm25", "no2", "ozone"),
labels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
plot_dat <- list()
for (exp in c("pm25")) {
load(paste0(dir_data, "analysis/gamns3log_dlm_comprisk_contUS_", AD_ADRD, "_",
code_type, "_", exp, ".rda"))
df <- 3
fit <- res[[df]]$cp$matfit[2,] * exp_iqr
se <- res[[df]]$cp$matse[2,] * 1.96 * exp_iqr
fit_cum <- res[[df]]$cp$allfit[2] * exp_iqr
se_cum <- res[[df]]$cp$allse[2] * exp_iqr * 1.96
plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
est = exp(fit),
low = exp(fit - se),
high = exp(fit + se),
cum = exp(fit_cum),
cum_low = exp(fit_cum - se_cum ),
cum_high = exp(fit_cum + se_cum),
df = df,
exp = exp)
# plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
#                               est = exp(res[[df]]$cp$matfit[q3,] -
#                                           res[[df]]$cp$matfit[q1,]),
#                               low = exp(log(res[[df]]$cp$matRRlow[q3,]) -
#                                           log(res[[df]]$cp$matRRlow[q1,])),
#                               high = exp(log(res[[df]]$cp$matRRhigh[q3,]) -
#                                            log(res[[df]]$cp$matRRhigh[q1,])),
#                               df = df,
#                               exp = exp)
}
plot_dat <- rbindlist(plot_dat)
#### ggplot: df = 3 ####
plot_dat$exp <- factor(plot_dat$exp, levels = c("pm25", "no2", "ozone"),
labels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
#scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
plot_dat <- list()
for (exp in c("pm25", "no2")) {
load(paste0(dir_data, "analysis/gamns3log_dlm_comprisk_contUS_", AD_ADRD, "_",
code_type, "_", exp, ".rda"))
df <- 3
fit <- res[[df]]$cp$matfit[2,] * exp_iqr
se <- res[[df]]$cp$matse[2,] * 1.96 * exp_iqr
fit_cum <- res[[df]]$cp$allfit[2] * exp_iqr
se_cum <- res[[df]]$cp$allse[2] * exp_iqr * 1.96
plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
est = exp(fit),
low = exp(fit - se),
high = exp(fit + se),
cum = exp(fit_cum),
cum_low = exp(fit_cum - se_cum ),
cum_high = exp(fit_cum + se_cum),
df = df,
exp = exp)
}
plot_dat <- rbindlist(plot_dat)
#### ggplot: df = 3 ####
plot_dat$exp <- factor(plot_dat$exp, levels = c("pm25", "no2", "ozone"),
labels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
#scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
##### Setup #####
AD_ADRD <- "ADRD" # AD or ADRD
code_type <- "any" # primary or any
library(data.table)
library(fst)
library(NSAPHutils)
library(mgcv)
library(dlnm)
library(ggplot2)
options(stringsAsFactors = FALSE)
setDTthreads(threads = 1)
dir_data <- "/nfs/home/D/dam9096/shared_space/ci3_analysis/dmork/Data/DLM_ADRD/"
##### Load DLNM results #####
load(paste0(dir_data, "analysis/gamns_dlnmlog34_comprisk_contUSsamp_", AD_ADRD, "_",
code_type, "_pm25.rda"))
pm_dlnm <- cp_dlnm
pm_levs <- k
load(paste0(dir_data, "analysis/gamns_dlnmlog34_comprisk_contUSsamp_", AD_ADRD, "_",
code_type, "_no2.rda"))
no_dlnm <- cp_dlnm
no_levs <- k
load(paste0(dir_data, "analysis/gamns_dlnmlog34_comprisk_contUSsamp_", AD_ADRD, "_",
code_type, "_ozone.rda"))
oz_dlnm <- cp_dlnm
oz_levs <- k
##### Create data table of results #####
lag_vals <- seq(1, 10, by = 0.2)
exp_dt <- rbindlist(list(
rbindlist(lapply(2:6, function(q) {
data.table(exp = "PM2.5",
lag = lag_vals,
quantile = names(pm_levs)[q],
val = pm_levs[q],
RR = pm_dlnm$matRRfit[paste0(pm_levs[q]),],
RRlow = pm_dlnm$matRRlow[paste0(pm_levs[q]),],
RRhigh = pm_dlnm$matRRhigh[paste0(pm_levs[q]),],
cumRR = pm_dlnm$allRRfit[paste0(pm_levs[q])],
cumRRlow = pm_dlnm$allRRlow[paste0(pm_levs[q])],
cumRRhigh = pm_dlnm$allRRhigh[paste0(pm_levs[q])])
})),
rbindlist(lapply(2:6, function(q) {
data.table(exp = "NO2",
lag = lag_vals,
quantile = names(no_levs)[q],
val = no_levs[q],
RR = no_dlnm$matRRfit[paste0(no_levs[q]),],
RRlow = no_dlnm$matRRlow[paste0(no_levs[q]),],
RRhigh = no_dlnm$matRRhigh[paste0(no_levs[q]),],
cumRR = no_dlnm$allRRfit[paste0(no_levs[q])],
cumRRlow = no_dlnm$allRRlow[paste0(no_levs[q])],
cumRRhigh = no_dlnm$allRRhigh[paste0(no_levs[q])])
})),
rbindlist(lapply(2:6, function(q) {
data.table(exp = "Summer Ozone",
lag = lag_vals,
quantile = names(oz_levs)[q],
val = oz_levs[q],
RR = oz_dlnm$matRRfit[paste0(oz_levs[q]),],
RRlow = oz_dlnm$matRRlow[paste0(oz_levs[q]),],
RRhigh = oz_dlnm$matRRhigh[paste0(oz_levs[q]),],
cumRR = oz_dlnm$allRRfit[paste0(oz_levs[q])],
cumRRlow = oz_dlnm$allRRlow[paste0(oz_levs[q])],
cumRRhigh = oz_dlnm$allRRhigh[paste0(oz_levs[q])])
}))))
##### DLNM Plot #####
exp_dt$exp <- factor(exp_dt$exp,
levels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(exp_dt) +
geom_hline(yintercept = 1, color = "black", size = 1) +
# geom_ribbon(aes(x = lag, ymin = RRlow, ymax = RRhigh, fill = quantile), alpha = 0.3) +
geom_line(aes(x = lag, y = RR, color = quantile, linetype = quantile), size = 2) +
facet_grid( ~ exp) +
theme_bw(base_size = 32) +
theme(legend.position = "bottom", legend.key.width = unit(1, "cm")) +
scale_x_continuous(breaks = (1:5)*2, minor_breaks = NULL, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds",
color = "", linetype = "", fill = "") +
theme(legend.position = c(0.92, 0.87),
legend.background = element_blank(),
legend.key.height = unit(1, "cm"),
legend.key.width = unit(2.5, "cm"))
ggplot(exp_dt) +
geom_hline(yintercept = 1, color = "black", size = 1) +
# geom_ribbon(aes(x = lag, ymin = RRlow, ymax = RRhigh, fill = quantile), alpha = 0.3) +
geom_line(aes(x = lag, y = RR, color = quantile, linetype = quantile), size = 2) +
facet_grid( ~ exp) +
theme_bw(base_size = 32) +
theme(legend.position = "bottom", legend.key.width = unit(1, "cm")) +
scale_x_continuous(breaks = (1:5)*2, minor_breaks = NULL, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds",
color = "", linetype = "", fill = "") +
theme(legend.position = c(0.92, 0.84),
legend.background = element_blank(),
legend.key.height = unit(1, "cm"),
legend.key.width = unit(2.5, "cm"))
ggplot(exp_dt) +
geom_hline(yintercept = 1, color = "black", size = 1) +
# geom_ribbon(aes(x = lag, ymin = RRlow, ymax = RRhigh, fill = quantile), alpha = 0.3) +
geom_line(aes(x = lag, y = RR, color = quantile, linetype = quantile), size = 2) +
facet_grid( ~ exp) +
theme_bw(base_size = 32) +
theme(legend.position = "bottom", legend.key.width = unit(1, "cm")) +
scale_x_continuous(breaks = (1:5)*2, minor_breaks = NULL, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds",
color = "", linetype = "", fill = "") +
theme(legend.position = c(0.93, 0.82),
legend.background = element_blank(),
legend.key.height = unit(1, "cm"),
legend.key.width = unit(2.5, "cm"))
##### Cumulative effect plot #####
ggplot(exp_dt[lag == 1]) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar(aes(x = quantile, ymin = cumRRlow, ymax = cumRRhigh), width = 0.5, size = 2) +
geom_point(aes(x = quantile, y = cumRR), size = 3) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
labs(x = "Exposure percentile", y = "Cumulative hazard odds")
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
#scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
plot_dat <- list()
for (exp in c("pm25", "no2", "ozone")) {
load(paste0(dir_data, "analysis/gamns3log_dlm_comprisk_contUS_", AD_ADRD, "_",
code_type, "_", exp, ".rda"))
df <- 3
fit <- res[[df]]$cp$matfit[2,] * exp_iqr
se <- res[[df]]$cp$matse[2,] * 1.96 * exp_iqr
fit_cum <- res[[df]]$cp$allfit[2] * exp_iqr
se_cum <- res[[df]]$cp$allse[2] * exp_iqr * 1.96
plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
est = exp(fit),
low = exp(fit - se),
high = exp(fit + se),
cum = exp(fit_cum),
cum_low = exp(fit_cum - se_cum ),
cum_high = exp(fit_cum + se_cum),
df = df,
exp = exp)
}
plot_dat <- rbindlist(plot_dat)
#### ggplot: df = 3 ####
plot_dat$exp <- factor(plot_dat$exp, levels = c("pm25", "no2", "ozone"),
labels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
#scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
##### Setup #####
AD_ADRD <- "ADRD" # AD or ADRD
code_type <- "any" # primary or any
n_threads = 16
library(data.table)
library(fst)
library(NSAPHutils)
options(stringsAsFactors = FALSE)
Sys.setenv(OMP_NUM_THREADS = n_threads)
setDTthreads(threads = n_threads)
dir_data <- "/nfs/home/D/dam9096/shared_space/ci3_analysis/dmork/Data/DLM_ADRD/"
##### Load cleaned data #####
qid_dat <- read_fst(paste0(dir_data, "analysis/contUS_", AD_ADRD, "_",
code_type, "_qid_clean.fst"), as.data.table = TRUE)
##### Summary stats #####
(n <- qid_dat[year == 2010, .N]) # unique individuals
qid_dat[year == 2010, mean(age_corrected)]
qid_dat[year == 2010, .(.N, .N/n), by = race] # breakdown by race
qid_dat[year == 2010, .(.N, .N/n), by = sexM] # breakdown by sex
qid_dat[year == 2010, .(.N, .N/n), by = dual] # breakdown by dual eligible
qid_dat[year == 2010, .(age = mean(age_corrected), sd = sd(age_corrected),
min = min(age_corrected), max = max(age_corrected))] # age
qid_dat[year == 2010, .(age7584 = sum(age_corrected >=75 & age_corrected < 85)/.N,
age8594 = sum(age_corrected >=85 & age_corrected < 95)/.N,
age95 = sum(age_corrected >= 95)/.N)] # age
qid_dat[year == 2010, .(age7584 = sum(age_corrected >=75 & age_corrected < 85),
age8594 = sum(age_corrected >=85 & age_corrected < 95),
age95 = sum(age_corrected >= 95),
age7584p = sum(age_corrected >=75 & age_corrected < 85)/.N,
age8594p = sum(age_corrected >=85 & age_corrected < 95)/.N,
age95p = sum(age_corrected >= 95)/.N)] # age
qid_dat[, .N] # person years = 41943031
4369407/27133737
9170192/27133737
3385436/27133737
library(data.table)
library(ggplot2)
AD_ADRD <- "ADRD" # AD or ADRD
code_type <- "any" # primary or any
dir_data <- "/nfs/home/D/dam9096/shared_space/ci3_analysis/dmork/Data/DLM_ADRD/"
plot_dat <- list()
for (exp in c("pm25", "no2", "ozone")) {
load(paste0(dir_data, "analysis/gamns3log_dlm_comprisk_contUS_", AD_ADRD, "_",
code_type, "_", exp, ".rda"))
df <- 3
fit <- res[[df]]$cp$matfit[2,] * exp_iqr
se <- res[[df]]$cp$matse[2,] * 1.96 * exp_iqr
fit_cum <- res[[df]]$cp$allfit[2] * exp_iqr
se_cum <- res[[df]]$cp$allse[2] * exp_iqr * 1.96
plot_dat[[exp]] <- data.table(lag = seq(1, 10, by = 0.2),
est = exp(fit),
low = exp(fit - se),
high = exp(fit + se),
cum = exp(fit_cum),
cum_low = exp(fit_cum - se_cum ),
cum_high = exp(fit_cum + se_cum),
df = df,
exp = exp)
}
plot_dat <- rbindlist(plot_dat)
#### ggplot: df = 3 ####
plot_dat$exp <- factor(plot_dat$exp, levels = c("pm25", "no2", "ozone"),
labels = c("PM2.5", "NO2", "Summer Ozone"))
ggplot(plot_dat, aes(x = lag, y = est,
ymin = low, ymax = high, group = df)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_ribbon(fill = "grey", color = "grey", size = 2) +
geom_line(size = 2) +
facet_grid(~exp) +
theme_bw(base_size = 32) +
scale_x_continuous(breaks = 1:5 * 2, minor_breaks = NULL, expand = c(0, 0)) +
#scale_y_continuous(expand = c(0, 0), limits = c(0.96, 1.19)) +
labs(x = "Years prior", y = "Hazard odds")
ggplot(plot_dat[lag == 1],
aes(x = exp, y = cum, ymin = cum_low, ymax = cum_high)) +
geom_hline(yintercept = 1, color = "black", size = 1) +
geom_errorbar( width = 0.5, size = 2) +
geom_point(size = 3) +
theme_bw(base_size = 32) +
labs(x = "Years prior", y = "Cumulative hazard odds")
plot_dat[lag == 1]
##### Load DLNM results #####
load(paste0(dir_data, "analysis/gamns_dlnmlog34_comprisk_contUSsamp_", AD_ADRD, "_",
code_type, "_pm25.rda"))
pm_dlnm <- cp_dlnm
pm_levs <- k
k
load(paste0(dir_data, "analysis/gamns_dlnmlog34_comprisk_contUSsamp_", AD_ADRD, "_",
code_type, "_no2.rda"))
no_dlnm <- cp_dlnm
no_levs <- k
load(paste0(dir_data, "analysis/gamns_dlnmlog34_comprisk_contUSsamp_", AD_ADRD, "_",
code_type, "_ozone.rda"))
oz_dlnm <- cp_dlnm
oz_levs <- k
##### Create data table of results #####
lag_vals <- seq(1, 10, by = 0.2)
exp_dt <- rbindlist(list(
rbindlist(lapply(2:6, function(q) {
data.table(exp = "PM2.5",
lag = lag_vals,
quantile = names(pm_levs)[q],
val = pm_levs[q],
RR = pm_dlnm$matRRfit[paste0(pm_levs[q]),],
RRlow = pm_dlnm$matRRlow[paste0(pm_levs[q]),],
RRhigh = pm_dlnm$matRRhigh[paste0(pm_levs[q]),],
cumRR = pm_dlnm$allRRfit[paste0(pm_levs[q])],
cumRRlow = pm_dlnm$allRRlow[paste0(pm_levs[q])],
cumRRhigh = pm_dlnm$allRRhigh[paste0(pm_levs[q])])
})),
rbindlist(lapply(2:6, function(q) {
data.table(exp = "NO2",
lag = lag_vals,
quantile = names(no_levs)[q],
val = no_levs[q],
RR = no_dlnm$matRRfit[paste0(no_levs[q]),],
RRlow = no_dlnm$matRRlow[paste0(no_levs[q]),],
RRhigh = no_dlnm$matRRhigh[paste0(no_levs[q]),],
cumRR = no_dlnm$allRRfit[paste0(no_levs[q])],
cumRRlow = no_dlnm$allRRlow[paste0(no_levs[q])],
cumRRhigh = no_dlnm$allRRhigh[paste0(no_levs[q])])
})),
rbindlist(lapply(2:6, function(q) {
data.table(exp = "Summer Ozone",
lag = lag_vals,
quantile = names(oz_levs)[q],
val = oz_levs[q],
RR = oz_dlnm$matRRfit[paste0(oz_levs[q]),],
RRlow = oz_dlnm$matRRlow[paste0(oz_levs[q]),],
RRhigh = oz_dlnm$matRRhigh[paste0(oz_levs[q]),],
cumRR = oz_dlnm$allRRfit[paste0(oz_levs[q])],
cumRRlow = oz_dlnm$allRRlow[paste0(oz_levs[q])],
cumRRhigh = oz_dlnm$allRRhigh[paste0(oz_levs[q])])
}))))
exp_dt[lag == 1]
plot_dat[lag==1]
pm_levs
diff(pm_levs[c(3,5)])
diff(no_levs[c(3,5)])
no_levs
exp_dt[lag==1&exp=="NO2"]
exp_dt[lag==10&exp=="NO2"]
pm_levs
no_levs
oz_levs
